var ylkMonitor=function(){"use strict";function o(n,e){this.config=n,this.submit_log=[],this.merge_lock=!1,this.push=function(e){this.submit_log.push(e),this.report()},this.report=function(){var e=this;if(n.mergeReport&&0<this.submit_log.length){if(this.merge_lock)return;e.merge_lock=!0,setTimeout(function(){e.submit(),e.merge_lock=!1},1e3*n.delay)}else e.submit()},this.submit=function(e){var r={id:n.id,log:e||this.submit_log,device:null,time:(new Date).getTime()};r.device=this.getDeviceInfo();var t=new XMLHttpRequest;t.open("post",n.url),t.setRequestHeader("Content-type","application/json"),t.send(JSON.stringify(r)),e||(this.submit_log=[]),t.onreadystatechange=function(){}},this.getDeviceInfo=function(){return(e||window).navigator.userAgent}}var i=function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e},u=function(e){var r=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){r(),e()}},c=function(e,r){return Object.prototype.toString.call(e)==="[object "+(r||"Object")+"]"},d=function(e){var r=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),t=e.toString();return r.indexOf(t)<0&&(r=t+"@"+r),r};var m={id:"",mergeReport:!0,delay:1e3,url:"http://127.0.0.1:5500",random:1,performance:{open:!0,random:1},error:{open:!0,random:1,ignore:[]},waitLoadTime:5};return window.ylkMonitor={init:function(e){var r=window;if(e.url)if(e.id){!0===e.performance&&(e.performance=m.performance,e.performance.open=!0),!0===e.error&&(e.error=m.error,e.error.open=!0);var a,s,t=i(m,e),n=this.reporter=new o(t,r);t.performance&&function(o,e,i){if(!(Math.random()>(e.performance.random||e.random))){var r=!1,a=!1;u(function(){a||(t(),r=!0)}),setTimeout(function(){console.log(e.waitLoadTime,r),r||t()},1e3*e.waitLoadTime)}function t(){var e=o.performance||window.performance;if(e&&e.timing){var r=e.timing,t={};for(var n in r)"number"==typeof r[n]&&(t[n]=(r[n]+"").substring(6));return i.push({type:"performance",data:t}),a=!0,t}}}(r,t,n),t.error&&(a=t,s=n,(r||window).onerror=function(e,r,t,n,o){var i=e;o&&o.stack&&(i=d(o)),c(i,"Event")&&(i+=i.type?"--"+i.type+"--"+(i.target?i.target.tagName+"::"+i.target.src:""):""),Math.random()<(a.error.random||a.random)&&s.push({type:"error",data:{msg:i,target:r,rowNum:t,colNum:n,_orgMsg:e}})},window.addEventListener("error",function(e){e.stopImmediatePropagation();var r=e.srcElement;r===window||Math.random()<(a.error.random||a.random)&&s.push({type:"error",data:{url:r.src||r.href,tag:r.tagName}})},!0),window.addEventListener("unhandledrejection",function(e){e.preventDefault(),Math.random()<(a.error.random||a.random)&&s.push({type:"error",data:{msg:e.reason.message||"_",stack:e.reason.stack||"_"}})}))}else console.warn("ylkMonitor options’s id is needed");else console.warn("ylkMonitor options’s url is needed")},push:function(e){this.reporter.push(e)},submit:function(e){this.reporter.submit([e])}}}();
