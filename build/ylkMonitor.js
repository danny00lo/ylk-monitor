var ylkMonitor=function(){"use strict";function n(o,r){this.config=o,this.submit_log=[],this.error_times={},this.merge_lock=!1,this.push=function(r){this.isRepeat(r)||(this.submit_log.push(r),this.report())},this.report=function(){var r=this;if(o.mergeReport&&0<this.submit_log.length){if(this.merge_lock)return;r.merge_lock=!0,setTimeout(function(){r.submit(),r.merge_lock=!1},1e3*o.delay)}else r.submit()},this.submit=function(r){var e={id:o.id,log:r||this.submit_log,device:null,time:(new Date).getTime()};e.device=this.getDeviceInfo();var t=new XMLHttpRequest;t.open("post",o.url),t.setRequestHeader("Content-type","application/json"),t.send(JSON.stringify(e)),r||(this.submit_log=[]),t.onreadystatechange=function(){}},this.getDeviceInfo=function(){return(r||window).navigator.userAgent},this.isRepeat=function(r){if(r.hash){var e=this.error_times[r.hash]=(this.error_times[r.hash]||0)+1;return 0<o.error.repeat&&e>o.error.repeat}return!1}}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-".split(""),a=function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},s=function(r){var e=window.onload;"function"!=typeof window.onload?window.onload=r:window.onload=function(){e(),r()}},c=function(r,e){return Object.prototype.toString.call(r)==="[object "+(e||"Object")+"]"},u=function(r){var e=r.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),t=r.toString();return e.indexOf(t)<0&&(e=t+"@"+e),e},m=function(r){var e=5381,t=r.length-1;if("string"==typeof r)for(;-1<t;t--)e+=(e<<5)+r.charCodeAt(t);else for(;-1<t;t--)e+=(e<<5)+r[t];for(var o=2147483647&e,n="";n+=i[63&o],o>>=6;);return n};var f={id:"",mergeReport:!0,delay:1e3,url:"http://127.0.0.1:5500",random:1,performance:{open:!0,random:1},error:{open:!0,random:1,repeat:5,ignore:[]},waitLoadTime:5};return window.ylkMonitor={init:function(r){var e=window;if(r.url)if(r.id){!0===r.performance?r.performance=f.performance:r.performance&&(r.performance=a(f.performance,r.performance)),!0===r.error?r.error=f.error:r.error&&(r.error=a(f.error,r.error));var t=a(f,r),o=this.reporter=new n(t,e);!0!==t.performance&&!0!==t.performance.open||function(n,r,i){if(!(Math.random()>(r.performance.random||r.random))){var e=!1,a=!1;s(function(){a||(t(),e=!0)}),setTimeout(function(){console.log(r.waitLoadTime,e),e||t()},1e3*r.waitLoadTime)}function t(){var r=n.performance||window.performance;if(r&&r.timing){var e=r.timing,t={};for(var o in e)"number"==typeof e[o]&&(t[o]=(e[o]+"").substring(6));return i.push({type:"performance",data:t}),a=!0,t}}}(e,t,o),!0!==t.error&&!0!==t.error.open||function(r,a,e){function s(r){e.push({type:"error",data:r,hash:m(JSON.stringify(r))})}(r||window).onerror=function(r,e,t,o,n){var i=r;n&&n.stack&&(i=u(n)),c(i,"Event")&&(i+=i.type?"--"+i.type+"--"+(i.target?i.target.tagName+"::"+i.target.src:""):""),Math.random()<(a.error.random||a.random)&&s({msg:i,target:e,rowNum:t,colNum:o,_orgMsg:r})},window.addEventListener("error",function(r){r.stopImmediatePropagation();var e=r.srcElement;e===window||Math.random()<(a.error.random||a.random)&&s({url:e.src||e.href,tag:e.tagName})},!0),window.addEventListener("unhandledrejection",function(r){r.preventDefault(),Math.random()<(a.error.random||a.random)&&s({msg:r.reason.message||"_",stack:r.reason.stack||"_"})})}(e,t,o)}else console.warn("ylkMonitor options’s id is needed");else console.warn("ylkMonitor options’s url is needed")},push:function(r){this.reporter.push(r)},submit:function(r){this.reporter.submit([r])}}}();
